<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Caffe</title>

    <link rel="stylesheet" href="stylesheets/reset.css">
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46255508-1', 'daggerfs.com');
    ga('send', 'pageview');
  </script>
    <div class="wrapper">
      <header>
        <h1 class="header"><a href="index.html">Caffe</a></h1>
        <p class="header">Convolutional Architecture for Fast Feature Embedding</p>

        <ul>
          <!--<li class="download"><a class="buttons" href="https://github.com/BVLC/caffe/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/BVLC/caffe/tarball/master">Download TAR</a></li>-->
          <li><a class="buttons github" href="https://github.com/BVLC/caffe">View On GitHub</a></li>
        </ul>
        <p class="header">Maintained by<br><a class="header name" href="http://ucbvlc.org/">BVLC</a></p>
        <p class="header">Created by<br><a class="header name" href="http://daggerfs.com/">Yangqing Jia</a></p>

      </header>
      <section>

      <h1 id="installation">Installation</h1>

<p>Prior to installing, it is best to read through this guide and take note of the details for your platform. We mostly develop and deploy on Ubuntu 12.04, although we have also installed on OS X 10.8 (and 10.9 with further effort) through homebrew.</p>

<ul>
<li><a href="#prequequisites">Prerequisites</a></li>

<li><a href="#compilation">Compilation</a></li>

<li><a href="#os_x_installation">OS X installation</a></li>

<li><a href="#hardware_questions">Hardware questions</a></li>
</ul>

<p>To build and test Caffe do</p>

<pre><code>cp Makefile.config.example Makefile.config
make
make test
make runtest</code></pre>

<p>You will probably need to adust paths in <code>Makefile.config</code> and maybe the <code>Makefile</code> itself. Feel free to issue a pull request for a change that may help other people.</p>

<p>Note that building and running CPU-only works, but GPU tests will naturally fail.</p>

<p>The following sections detail prerequisites and installation on Ubuntu. For OS X notes, refer to the table of contents above to skip ahead.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
<li><a href="https://developer.nvidia.com/cuda-zone">CUDA</a> 5.0 or 5.5</li>

<li><a href="http://www.boost.org/">boost</a> (1.55 preferred)</li>

<li><a href="http://en.wikipedia.org/wiki/Basic_Linear_Algebra_Subprograms">BLAS</a> by <a href="http://software.intel.com/en-us/intel-mkl">MKL</a> (though the <code>dev</code> branch supports ATLAS and OpenBLAS as alternatives)</li>

<li><a href="http://opencv.org/">OpenCV</a></li>

<li>glog, gflags, protobuf, leveldb, snappy, hdf5</li>

<li>For the python wrapper: python, numpy (&gt;= 1.7 preferred), and boost_python</li>

<li>For the MATLAB wrapper: MATLAB with mex</li>
</ul>

<p><strong>CUDA</strong>: Caffe requires the CUDA NVCC compiler to compile its GPU code. To install CUDA, go to the <a href="https://developer.nvidia.com/cuda-downloads">NVIDIA CUDA website</a> and follow installation instructions there. Caffe compiles with both CUDA 5.0 and 5.5.</p>

<p>N.B. one can install the CUDA libraries without the CUDA driver in order to build and run Caffe in CPU-only mode.</p>

<p><strong>MKL/BLAS</strong>: the current stable release of Caffe needs Intel MKL as the backend of its matrix and vector computations. The <a href="https://github.com/BVLC/caffe/tree/dev">development version</a> supports ATLAS and OpenBLAS backends as alternatives (while retaining MKL support). For MKL, you can obtain a <a href="http://software.intel.com/en-us/intel-mkl">trial license</a> or an <a href="http://software.intel.com/en-us/intel-education-offerings">academic license</a> (if you are a student).</p>

<p><strong>The Rest</strong>: you will also need other packages, most of which can be installed via apt-get using:</p>

<pre><code>sudo apt-get install libprotobuf-dev libleveldb-dev libsnappy-dev libopencv-dev libboost-all-dev libhdf5-serial-dev</code></pre>

<p>The only exception being the google logging library, which does not exist in the Ubuntu 12.04 repository. To install it, do:</p>

<pre><code>wget https://google-glog.googlecode.com/files/glog-0.3.3.tar.gz
tar zxvf glog-0.3.3.tar.gz
./configure
make &amp;&amp; make install</code></pre>

<p><strong>Python</strong>: If you would like to have the python wrapper, install python, numpy and boost_python. You can either compile them from scratch or use a pre-packaged solution like <a href="https://store.continuum.io/cshop/anaconda/">Anaconda</a> or <a href="https://www.enthought.com/products/canopy/">Enthought Canopy</a>. Note that if you use the Ubuntu default python, you will need to apt-install the <code>python-dev</code> package to have the python headers. You can install any remaining dependencies with</p>

<pre><code>pip install -r /path/to/caffe/python/requirements.txt</code></pre>

<p><strong>MATLAB</strong>: if you would like to have the MATLAB wrapper, install MATLAB with the mex compiler.</p>

<p>Now that you have the prerequisites, edit your <code>Makefile.config</code> to change the paths for your setup.</p>

<h2 id="compilation">Compilation</h2>

<p>With the prerequisites installed, do <code>make all</code> to compile Caffe.</p>

<p>To compile the python and MATLAB wrappers do <code>make pycaffe</code> and <code>make matcaffe</code> respectively.</p>

<p><em>Distribution</em>: run <code>make distribute</code> to create a <code>distribute</code> directory with all the Caffe headers, compiled libraries, binaries, etc. needed for distribution to other machines.</p>

<p><em>Speed</em>: for a faster build, compile in parallel by doing <code>make all -j8</code> where 8 is the number of parallel threads for compilation (a good choice for the number of threads is the number of cores in your machine).</p>

<p><em>Python Module</em>: for python support, you must add the compiled module to your <code>PYTHONPATH</code> (as <code>/path/to/caffe/python</code> or the like).</p>

<p>Now that you have installed Caffe, check out the <a href="mnist.html">MNIST demo</a> and the pretrained <a href="imagenet.html">ImageNet example</a>.</p>

<h2 id="os_x_installation">OS X Installation</h2>

<p>On 10.8, we have successfully compiled and run Caffe on GPU-equipped Macbook Pros. Caffe also runs on 10.9, but you need to do a few extra steps described below.</p>

<h3 id="install_prerequisites_using_homebrew">Install prerequisites using Homebrew</h3>

<p>Install <a href="http://brew.sh/">homebrew</a> to install most of the prerequisites. Starting from a clean install of the OS (or from a wiped <code>/usr/local</code>) is recommended to avoid conflicts. For python, <a href="https://store.continuum.io/cshop/anaconda/">Anaconda</a> and homebrew python are confirmed to work.</p>

<pre><code># install python by (1) Anaconda or (2) brew install python
brew install --build-from-source boost
brew install snappy leveldb protobuf gflags glog
brew tap homebrew/science
brew install homebrew/science/hdf5
brew install homebrew/science/opencv</code></pre>

<p>Building boost from source is needed to link against your local python (exceptions might be raised during some OS X installs, but ignore these and continue). If using homebrew python, python packages like <code>numpy</code> and <code>scipy</code> are best installed by doing <code>brew tap homebrew/python</code>, and then installing them with homebrew.</p>

<h4 id="109_additional_notes">10.9 additional notes</h4>

<p>In OS X 10.9 Apple changed to clang as the default compiler. Clang uses libc++ as the standard library by default, while NVIDIA CUDA currently works with libstdc++. This makes it necessary to change the compilation settings for each of the dependencies. We do this by modifying the homebrew formulae before installing any packages. Make sure that homebrew doesn’t install any software dependencies in the background; all packages must be linked to libstdc++.</p>

<p>Only Anaconda python has been confirmed to work on 10.9.</p>

<p>For each package that you install through homebrew do the following:</p>

<ol>
<li>Open formula in editor: <code>brew edit FORMULA</code></li>

<li>Add the ENV definitions as shown in the code block below.</li>

<li>Uninstall any formulae that were already installed: <code>brew uninstall FORMULA</code></li>

<li>Install / Reinstall: <code>brew install --build-from-source --fresh -vd FORMULA</code></li>
</ol>

<pre><code>    def install
        #ADD THE FOLLOWING:
        ENV.append &quot;CXXFLAGS&quot;, &#39;-stdlib=libstdc++&#39;
        ENV.append &quot;CFLAGS&quot;, &#39;-stdlib=libstdc++&#39;
        ENV.append &quot;LDFLAGS&quot;, &#39;-stdlib=libstdc++ -lstdc++&#39;
        #The following is necessary because libtool liks to strip LDFLAGS:
        ENV.cxx = &quot;/usr/bin/clang -stdlib=libstdc++&quot;

        ...</code></pre>

<p>The prerequisite homebrew formulae are</p>

<pre><code>boost snappy leveldb protobuf gflags glog szip homebrew/science/hdf5 homebrew/science/opencv</code></pre>

<p>so follow steps 1-4 for each.</p>

<p>After this the rest of the installation is the same as under 10.8, as long as <code>clang++</code> is invoked with <code>-stdlib=libstdc++</code> and <code>-lstdc++</code> is linked.</p>

<h3 id="cuda_and_mkl">CUDA and MKL</h3>

<p>CUDA and MKL are straightforward to install; download from the NVIDIA and Intel links under “Prerequisites.”</p>

<h3 id="compiling_caffe">Compiling Caffe</h3>

<p>Here are the relevant parts of the Makefile.config after all this:</p>

<pre><code>CUDA_DIR := /Developer/NVIDIA/CUDA-5.5
MKL_DIR := /opt/intel/mkl
PYTHON_INCLUDES := /path/to/anaconda/include /path/to/anaconda/include/python2.7 /path/to/anaconda/lib/python2.7/site-packages/numpy/core/include
PYTHON_LIB := /path/to/anaconda/lib
CXX=/usr/bin/clang++</code></pre>

<p>Don’t forget to set <code>PATH</code> and <code>LD_LIBRARY_PATH</code>:</p>

<pre><code>export PATH=/path/to/anaconda/bin:/Developer/NVIDIA/CUDA-5.5/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/X11/bin
export LD_LIBRARY_PATH=/Developer/NVIDIA/CUDA-5.5/lib:/opt/intel/composer_xe_2013_sp1.1.103/compiler/lib:/opt/intel/composer_xe_2013_sp1.1.103/mkl/lib:/path/to/anaconda/lib:/usr/local/lib:/usr/lib:/lib</code></pre>

<p>Additionally, MKL requires <code>DYLD_LIBRARY_PATH</code> to be set:</p>

<pre><code>export MKL_DIR=/opt/intel/composer_xe_2013_sp1.1.103
export DYLD_LIBRARY_PATH=$MKL_DIR/compiler/lib:$MKL_DIR/mkl/lib</code></pre>

<p>Note that we still need to include the MKL <code>compiler/lib</code> in our paths, although we do not explicitly link against this directory in the Makefile.</p>

<p>Further note that these paths are for Anaconda python. For homebrew python, substitute <code>/usr/local/Cellar/python/2.7.6/Frameworks/Python.framework/Versions/2.7</code> for <code>/path/to/anaconda</code>.</p>

<h2 id="hardware_questions">Hardware Questions</h2>

<p><strong>Laboratory Tested Hardware</strong>: Berkeley Vision runs Caffe with k40s, k20s, and Titans including models at ImageNet/ILSVRC scale. We also run on GTX series cards and GPU-equipped MacBook Pros. We have not encountered any trouble in-house with devices with CUDA capability &gt;= 3.0. All reported hardware issues thus-far have been due to GPU configuration, overheating, and the like.</p>

<p><strong>CUDA compute capability</strong>: devices with compute capability &lt;= 2.0 may have to reduce CUDA thread numbers and batch sizes due to hardware constraints. Your mileage may vary.</p>

<p>Refer to the project’s issue tracker for <a href="https://github.com/BVLC/caffe/issues?labels=hardware%2Fcompatibility&page=1&state=open">hardware/compatibility</a>.</p>

      </section>
      <footer>
        <p><small>Hosted on <a href="http://pages.github.com">GitHub Pages</a>.</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
  </body>
</html>
