#!/usr/bin/env node

var sys = require('sys'),
    fs = require('fs'),
    maker = require('./lib/node-build'),
    when = maker.when,
    unless = maker.unless,
    child_process  = require('child_process'),
    Script = process.binding('evals').Script;

var environment = {__dirname: __dirname}
Script.runInNewContext(fs.readFileSync('default.js', encoding='utf8'),environment,'default.js');

maker.define("init").perform.
    exists(environment.baseDir).
    mkDir(environment.buildDir).
    mkDir(environment.reportDir);

maker.define("all").dependsOn("init").perform.
    echo("Will add test here").
    rmDir(environment.buildDir+"/oopsy").
    fail("Oopsy",{condition: when.exists(environment.buildDir+"/oopsy")}).
    mkDir(environment.buildDir+"/oopsy").
    fail("Daisy",{condition: unless.exists(environment.buildDir+"/oopsy")});

maker.define("documentation").perform.
    generate_reference_documentation("../gh-pages-node-build/node-build/tasks.html", {fragment: true});



maker.achieve("documentation");
